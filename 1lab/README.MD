# Лабораторная 1. Файловый менеджер (сетевая часть)

## Описание

Этот проект представляет собой учебный пример **файлового менеджера** (имитацию простой “базы данных” на CSV-файлах) с использованием **TCP-сокетов** на низком уровне.

В рамках проекта:
- **Сервер**:
  - Хранит данные в формате CSV (каждая таблица — отдельная папка).
  - Принимает SQL-подобные запросы от клиентов (только `SELECT` с одним условием `WHERE`).
  - Возвращает результат в CSV-формате.
  - Может отдавать структуру таблиц в формате JSON.
  - Поддерживает базовую аутентификацию пользователей (логин/пароль).
  - Параллельно обслуживает несколько клиентов (каждый в своём потоке).
- **Клиент**:
  - Подключается к серверу через TCP-сокет.
  - Запрашивает логин/пароль у пользователя для авторизации.
  - Предоставляет возможность вводить команды (`SELECT ...`, `GET_JSON`, `QUIT`).
  - Отображает полученные от сервера результаты.

## Структура проекта

<pre> lab/ ├── data/ │ ├── users/ │ │ └── users.csv │ └── products/ │ └── products.csv ├── main.py ├── requirements.txt ├── server/ │ ├── __init__.py │ ├── server.py │ ├── client_handler.py │ ├── sql_parser.py │ ├── csv_manager.py │ ├── cache_manager.py │ ├── auth_manager.py │ ├── logger.py │ └── utils.py └── client/ ├── __init__.py ├── client.py ├── logger.py └── utils.py </pre>

- **main.py** – основной файл, точка входа. Запускает либо сервер, либо клиент (через аргумент `--mode`).
- **data/** – папка с данными (CSV). Каждая подпапка – это “таблица”.
  Например, data/users/users.csv содержит строки с колонками id,name,age.
- **server/** – модули, связанные с серверной логикой (поднятие сокета, парсер SQL, работа с CSV, кэш, аутентификация и пр.).
- **client/** – файлы, связанные с клиентской логикой (подключение к серверу, ввод команд, вывод результата).

## Требования и установка

1. Убедитесь, что у вас установлен **Python 3.7+** (рекомендуется 3.10 и выше).
2. Установите зависимости из requirements.txt:
   pip install -r requirements.txt
   
   (Если вы используете виртуальное окружение (venv), не забудьте его активировать перед установкой.)

## Запуск

1. Перейдите в папку проекта (там, где лежит main.py).
2. Запустите сервер (в одном окне/терминале):
   python main.py --mode server
   - Сервер поднимется, откроет порт (по умолчанию 9090) и будет ждать подключений.
   - Если у вас настроен логгинг в консоль, вы увидите сообщение о старте. Если нет — сервер просто будет “висеть” в ожидании.

3. Запустите клиент (во втором окне/терминале):
   python main.py --mode client
   - Клиент подключается к серверу, запросит у вас логин и пароль.

4. Введите команды:
   - SELECT * FROM users
     (Выводит все строки из CSV таблицы “users”)
   - SELECT name,age FROM users WHERE age > 20
     (Применяет условие и возвращает только name и age)
   - GET_JSON
     (Позволяет получить структуру таблиц в формате JSON, например: {"users": ["id","name","age"], "products":["id","title","price"]})
   - QUIT
     (Завершает работу клиента)

Примечание о python / python3:
В Windows достаточно python. В некоторых системах (Linux/macOS) может быть команда python3. Выбирайте ту, которая у вас работает.

## Аутентификация (логины и пароли)

По умолчанию, в файле server/auth_manager.py может быть задан такой словарь:
self.users = {
    "admin": "admin123",
    "user": "pass"
}
Чтобы изменить или добавить новых пользователей, отредактируйте этот словарь.
При запуске клиента (после --mode client), когда он попросит логин/пароль, введите, к примеру:
username: admin
password: admin123
Если аутентификация прошла успешно, получите ответ AUTH_OK.

## Как добавлять новые данные

1. Создать новую “таблицу” (например, orders) – нужно:
   - Создать подпапку data/orders/.
   - Положить туда один или несколько CSV-файлов (например, orders.csv), где первая строка – заголовок (колонки). Пример:
     order_id,user_id,amount
     1,1,500
     2,2,100
2. Перезапустить сервер (чтобы он заново просканировал папки).
3. Теперь можно делать запросы в клиенте:
   SELECT * FROM orders
   SELECT user_id, amount FROM orders WHERE amount > 200

Аналогично можно дополнять уже существующие CSV (например, users.csv) – откройте файл, допишите новую строку, сохраните.

## Логи

- Сервер:
  Если в server/logger.py (или аналогичном месте) настроено логирование в файл server.log, посмотрите туда.
  Если включён StreamHandler, логи будут и в консоли.
- Клиент:
  Аналогично, если в client/logger.py настроен файл client.log или вывод на экран.

## FAQ / Возможные проблемы

1. “Сервер запускается, но ничего не выводит”
   - Сервер может просто “ждать подключений” без дополнительных сообщений. Запустите клиент, и тогда в серверном логе появятся события.
2. “Не могу авторизоваться”
   - Проверьте, что логин/пароль совпадают с тем, что прописано в AuthManager.
   - Убедитесь, что формат отправляемой строки ("username password") согласован с тем, как сервер парсит её.
3. “Таблица не найдена”
   - Проверьте, что есть папка в data/ с именем, совпадающим с запросом.
   - Убедитесь, что в ней лежит CSV-файл. Название таблицы в запросе должно точно совпадать с именем папки.
4. “No data” при SELECT
   - Либо подходящих строк нет, либо нет такой колонки. Убедитесь, что колонки (заголовки) совпадают с теми, что в CSV-файле.
5. Добавление логинов/паролей
   - Измените файл auth_manager.py (или как он у вас называется) – добавьте нужные пары в словарь self.users.

## Дополнительные расширения

- SSL (TLS) для безопасной передачи логина/пароля (через ssl.wrap_socket).
- Более сложный SQL (JOIN, GROUP BY, несколько условий WHERE).
- Кэширование (уже есть в cache_manager.py, можно расширить).
- Тесты – написать unit-тесты и интеграционные тесты для проверки парсера, чтения CSV, работы с сокетами.
